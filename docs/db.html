<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.5.3/papaparse.min.js"
        integrity="sha256-NVP7i99bgATOVTHmgn6ByLNOezmSZ3lndUVEBk6XsBY=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/luxon@3.7.2/build/global/luxon.min.js"
        integrity="sha256-UWxf6lyCvfH7XEcrmq/cqc2m3IBrLBLOnWLC4Pw0gQQ=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/idb@8.0.3/build/umd.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

</head>

<body>
    <div id="navbar"></div>
    <div class="container">
        <h1>DB Test</h1>

        <div class="container">
            <div class="mb-3">
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#clearDataModal">
                    Clear all local data
                </button>
            </div>
            <div class="mb-3">
                <label for="fileZoomCSV" class="form-label">Upload one or more Zoom attendance CSV files.</label>
                <input class="form-control" type="file" id="fileZoomCSV" multiple>
            </div>
            <div class="mb-3">
                <h2>Meetings</h2>
                <div id="meetingList" class="container"></div>
            </div>
        </div>

    </div>

    <!-- Modal -->
    <div class="modal fade" id="clearDataModal" tabindex="-1" aria-labelledby="clearDataModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clearDataModalLabel">Are you sure you want to clear all local data?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    This will remove any data or settings that you have accumulated. You will have to upload your
                    attendance reports and re-do all configuration settings.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="clearData()">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- code -->

    <script type="text/javascript">

        const dbName = "Attendance";
        const dbVersion = 1; // Versioning is required for schema updates.
        const db = run();

        async function run(){
            try{
                const db = await initDb();
                await addRecord('meetings', meeting);
            } catch( err ) {
                console.error( err );
            }
           return db;
        }
    
        var meeting = {
            "meetingId": "996 9076 0374",
            "topic": "CS 100 Introduction to Information Technology 1803"    
        };

        async function initDb(){
            const db = await idb.openDB(dbName, dbVersion, {
                upgrade(db) {
                db.createObjectStore('meetings', { keyPath: 'id' });
                // store.createIndex('email', 'email', { unique: true });
                },
            });
            return db;
        }

        async function addRecord(storeName, data) {
            const tx = await db.transaction(storeName, 'readwrite');
            const store = tx.objectStore(storeName);
            await store.add(data);
            await tx.done;
        }


        

        window.addEventListener("load", async (event) => {

        });

        const fileInput = document.getElementById("fileZoomCSV");
        fileInput.addEventListener("change", () => {
            const files = fileInput.files;
            processFiles(files);
        });



    </script>
</body>

</html>