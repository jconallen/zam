<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.5.3/papaparse.min.js"
        integrity="sha256-NVP7i99bgATOVTHmgn6ByLNOezmSZ3lndUVEBk6XsBY=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/luxon@3.7.2/build/global/luxon.min.js"
        integrity="sha256-UWxf6lyCvfH7XEcrmq/cqc2m3IBrLBLOnWLC4Pw0gQQ=" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

</head>

<body>
    <div id="navbar"></div>
    <div class="container">
        <h1>DB Test</h1>

        <div class="container">
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">Email address</label>
                <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="name@example.com">
            </div>
            <div class="mb-3">
                <label for="exampleFormControlTextarea1" class="form-label">Example textarea</label>
                <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-primary" onclick="addUser()">Add User</button>
                <button type="button" class="btn btn-secondary" onclick="getUsers()">Get Users</button>
            </div>
        </div>

    </div>

    <!-- code -->

    <script type="text/javascript">

        window.addEventListener("load", (event) => {

            const dbName = "MyDatabase";
            const dbVersion = 1; // Versioning is required for schema updates.

            const request = indexedDB.open(dbName, dbVersion);

            request.onupgradeneeded = function (event) {
                const db = event.target.result;

                // Create an object store named 'users' with 'id' as the keyPath
                if (!db.objectStoreNames.contains("users")) {
                    db.createObjectStore("users", { keyPath: "id", autoIncrement: true });
                }
                console.log("Database setup complete");
            };

            request.onsuccess = function (event) {
                const db = event.target.result;
                console.log("Database opened successfully");
            };

            request.onerror = function (event) {
                console.error("Error opening database:", event.target.errorCode);
            };

        });

        function addUser() {

            var email = $('#exampleFormControlInput1').val();
            var description = $('#exampleFormControlTextarea1').val();

            const request = indexedDB.open("MyDatabase", 1);

            request.onsuccess = function (event) {
                const db = event.target.result;
                const transaction = db.transaction("users", "readwrite");
                const objectStore = transaction.objectStore("users");

                const user = { email, description };
                const addRequest = objectStore.add(user);

                addRequest.onsuccess = function () {
                    console.log("User added:", user);
                };

                addRequest.onerror = function (event) {
                    console.error("Error adding user:", event.target.error.message);
                };
            };
        }

        function getUsers() {
            const request = indexedDB.open("MyDatabase", 1);

            request.onsuccess = function (event) {
                const db = event.target.result;
                const transaction = db.transaction("users", "readonly");
                const objectStore = transaction.objectStore("users");

                const getRequest = objectStore.getAll();

                getRequest.onsuccess = function () {
                    if (getRequest.result) {
                        console.log("User found:", getRequest.result);
                    } else {
                        console.log("User not found");
                    }
                };

                getRequest.onerror = function (event) {
                    console.error("Error retrieving user:", event.target.errorCode);
                };
            };
        }



    </script>
</body>

</html>